# WatchProtocolSDK-ObjC v2.0.2 发布包说明

## 📦 包含内容

### 1. Framework 文件

```
WatchProtocolSDK.xcframework/
├── ios-arm64/                          # iOS 真机版本
│   └── WatchProtocolSDK.framework/
│       ├── WatchProtocolSDK           # 动态库二进制
│       ├── Headers/                    # 公开头文件
│       ├── Modules/                    # 模块定义
│       └── Info.plist
└── ios-arm64_x86_64-simulator/        # iOS 模拟器版本
    └── WatchProtocolSDK.framework/
        ├── WatchProtocolSDK
        ├── Headers/
        ├── Modules/
        └── Info.plist
```

### 2. 文档清单

| 文件名 | 用途 | 目标读者 |
|--------|------|----------|
| **README.md** | SDK API 文档和使用说明 | 所有用户 |
| **VERSION.txt** | 版本号（2.0.2） | 所有用户 |
| **RELEASE_NOTES_v2.0.2.md** | 本版本发布说明（推荐阅读⭐） | 所有用户 |
| **AUTO_RECONNECT_GUIDE.md** | 自动重连功能使用指南（英文） | 第三方开发者 |
| **自动重连使用指南.md** | 自动重连功能使用指南（中文，推荐⭐） | 第三方开发者 |
| **BATTERY_LEVEL_127_BUG_ANALYSIS.md** | 电量 127 问题详细分析报告 | 技术负责人 |
| **BATTERY_127_FIX_GUIDE.md** | 电量 127 问题快速修复指南 | 所有用户 |
| **DYNAMIC_FRAMEWORK_INTEGRATION.md** | 动态 Framework 集成指南 | 新用户 |
| **LINKER_ERROR_FIX.md** | 链接错误快速修复 | 遇到问题的用户 |

## 🎯 本次发布重点

### 核心修复：电量值 127 异常（BATTERY-127）

**问题**：设备返回电量值 127，超出协议规定的 0~100 范围

**修复**：
- ✅ SDK 自动将异常值限制在 0~100 范围
- ✅ 记录警告日志，便于问题追踪
- ✅ 保证回调给第三方的值始终正确

**影响**：
- 所有调用 `queryBatteryLevel()` 的用户
- 所有实现 `didReceiveBatteryLevel:isCharging:` 回调的用户

**推荐操作**：
- ⭐ 建议所有用户升级到此版本
- 无需修改代码，直接替换 Framework 即可

## 📚 快速导航

### 第三方开发者（推荐阅读）

1. **首先阅读**：`RELEASE_NOTES_v2.0.2.md`
   - 了解本版本修复了什么
   - 查看升级步骤

2. **集成新功能**：`自动重连使用指南.md`
   - App 杀掉后自动重连的完整教程
   - 复制即用的示例代码
   - 常见问题解答

3. **遇到问题**：`BATTERY_127_FIX_GUIDE.md`
   - 快速修复指南
   - 验证方法
   - 日志示例

### 技术负责人（深度分析）

1. **问题详情**：`BATTERY_LEVEL_127_BUG_ANALYSIS.md`
   - 完整的根因分析
   - 协议解析说明
   - 测试验证用例
   - 多种解决方案对比

2. **架构决策**：
   - 为什么选择在 SDK 层修复
   - 向后兼容性分析
   - 与设备固件团队的协作建议

### 新用户（首次集成）

1. **集成指南**：`DYNAMIC_FRAMEWORK_INTEGRATION.md`
   - 完整的集成步骤
   - Xcode 配置说明
   - Swift 项目集成方法

2. **API 文档**：`README.md`
   - 核心 API 说明
   - 使用示例
   - 系统要求

3. **常见问题**：`LINKER_ERROR_FIX.md`
   - 链接错误快速修复
   - 3 步解决方案
   - 其他常见问题

## 🔄 升级步骤（v2.0.0/v2.0.1 → v2.0.2）

### 步骤 1：替换 Framework

1. 删除旧版本的 `WatchProtocolSDK.xcframework`
2. 将新版本的 `WatchProtocolSDK.xcframework` 拖入项目
3. 确认 Embed 设置为 **"Embed & Sign"**

### 步骤 2：清理并重新编译

```bash
# Xcode 菜单栏
Product → Clean Build Folder (⇧⌘K)

# 或命令行
rm -rf ~/Library/Developer/Xcode/DerivedData/*
```

### 步骤 3：验证修复

运行 App 并测试电量查询：

```objc
[[WPBluetoothManager sharedInstance] queryBatteryLevel];

// 查看代理回调
- (void)didReceiveBatteryLevel:(NSInteger)batteryLevel isCharging:(BOOL)isCharging {
    // 验证：batteryLevel 应该在 0~100 范围内
    NSLog(@"电量: %ld%%", (long)batteryLevel);

    // 如果设备返回 127，SDK 会自动修正为 100
    // 并在日志中输出警告：
    // ⚠️ 电量值异常:127 (超出范围)，已修正为:100
}
```

## ✨ v2.0.2 特性总览

### 核心功能（继承自 v2.0.1）

- ✅ 蓝牙设备扫描和连接
- ✅ 设备信息查询
- ✅ 健康数据查询（电量、心率、血氧、血压等）
- ✅ 步数、睡眠数据获取
- ✅ 时间同步、屏幕亮度控制
- ✅ 个人信息设置
- ✅ 自动保存设备信息到沙盒
- ✅ 意外断开自动保留设备信息，便于重连

### 新增修复（v2.0.2）

- 🐛 **修复电量值 127 异常问题**
  - 自动范围检查
  - 异常值修正（127 → 100）
  - 警告日志记录

## 📊 版本对比

| 功能 | v2.0.0 | v2.0.1 | v2.0.2 |
|------|--------|--------|--------|
| 纯 ObjC 实现 | ✅ | ✅ | ✅ |
| 动态 Framework | ✅ | ✅ | ✅ |
| 自动保存设备 | ❌ | ✅ | ✅ |
| 健康数据 API | ❌ | ✅ | ✅ |
| 电量值范围检查 | ❌ | ❌ | ✅ |
| 自动重连教程 | ❌ | ❌ | ✅ |

## 🔍 技术规格

### Framework 信息

```
名称：WatchProtocolSDK.xcframework
版本：2.0.2
类型：动态 Framework
大小：832K
架构：
  - iOS 设备：arm64
  - iOS 模拟器：arm64 + x86_64
最低系统：iOS 13.0
```

### 依赖项

```
系统框架：
  - CoreBluetooth.framework
  - Foundation.framework

无第三方依赖
无 Swift 运行时依赖
```

### 符号验证

```bash
# 验证核心类符号
nm -g WatchProtocolSDK.xcframework/ios-arm64/WatchProtocolSDK.framework/WatchProtocolSDK \
  | grep OBJC_CLASS

# 应该看到：
✅ _OBJC_CLASS_$_WPBluetoothManager
✅ _OBJC_CLASS_$_WPDeviceManager
✅ _OBJC_CLASS_$_WPCommands
✅ _OBJC_CLASS_$_WPEmptyHealthDataStorage
✅ _OBJC_CLASS_$_WPLogger
✅ 无 Swift 符号（_Tt）
```

## 📞 支持与反馈

### 技术支持

如遇到问题，请提供：

1. **基本信息**
   - SDK 版本（2.0.2）
   - Xcode 版本
   - iOS 系统版本
   - 设备型号和固件版本

2. **完整日志**
   ```objc
   // 启用 SDK 日志
   [[WPLogger sharedInstance] setLogEnabled:YES];
   ```

3. **问题描述**
   - 问题现象
   - 复现步骤
   - 预期行为 vs 实际行为

### 问题类别

| 问题类型 | 参考文档 |
|---------|---------|
| 链接错误 | LINKER_ERROR_FIX.md |
| 电量异常 | BATTERY_127_FIX_GUIDE.md |
| 自动重连 | 自动重连使用指南.md |
| 集成问题 | DYNAMIC_FRAMEWORK_INTEGRATION.md |
| 深度分析 | BATTERY_LEVEL_127_BUG_ANALYSIS.md |

## 🎉 总结

### 推荐理由

1. **稳定性提升**
   - 修复了电量值异常问题
   - 增强了数据验证逻辑
   - 更好的错误处理

2. **完整文档**
   - 详细的发布说明
   - 自动重连教程
   - 问题分析报告
   - 快速修复指南

3. **向后兼容**
   - 无需修改代码
   - API 接口不变
   - 直接替换即可升级

4. **生产就绪**
   - 通过符号验证
   - 完整的测试用例
   - 832K 体积优化

### 升级建议

- ⭐⭐⭐ **强烈推荐**所有用户升级到 v2.0.2
- 特别是遇到电量值显示异常的用户
- 无缝升级，风险极低

---

**发布时间**：2026-01-20
**Framework 大小**：832K
**文档数量**：9 份
**状态**：✅ 生产就绪，推荐使用

**感谢使用 WatchProtocolSDK-ObjC！**
